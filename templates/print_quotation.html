<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devis {{ quotation.quotation_number }}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300..900;1,300..900&display=swap');
        :root { --yellow: #FBCF00; --black: #000000; --gray: #666666; --light-gray: #f5f5f5; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { margin: 0; padding: 0; width: 100%; min-height: 100vh; background-color: #e5e5e5; }
        body { font-family: 'DM Sans', sans-serif; line-height: 1.5; font-size: 11pt; color: var(--black); display: flex; justify-content: center; align-items: center; padding: 20px; }
        .no-print { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 1000; }
        .no-print button { padding: 10px 20px; border: none; border-radius: 4px; font-weight: 600; cursor: pointer; font-size: 14px; }
        .btn-print { background-color: var(--yellow); color: var(--black); }
        .btn-return { background-color: var(--black); color: white; }
        @media print { html, body { width: 210mm; height: 297mm; margin: 0; padding: 0; background: white; } .quotation-page { box-shadow: none !important; margin: 0 !important; } .no-print { display: none !important; } @page { size: A4; margin: 0; } }
        .quotation-page { width: 210mm; height: 297mm; background: white; box-shadow: 0 4px 20px rgba(0,0,0,0.1); position: relative; border: 8px solid var(--yellow); padding: 40px 50px; display: flex; flex-direction: column; }
        .logo-brand { font-size: 72px; font-weight: 900; font-style: italic; color: var(--yellow); letter-spacing: -2px; margin-bottom: 30px; line-height: 1; text-transform: uppercase; }
        .header-section { display: flex; gap: 40px; margin-bottom: 30px; }
        .info-column { flex: 0 0 auto; max-width: 250px; }
        .info-column h3 { font-size: 12px; font-weight: 700; color: var(--yellow); margin-bottom: 12px; }
        .info-column p { font-size: 11px; margin: 6px 0; color: var(--black); line-height: 1.6; }
        .info-column p strong { font-weight: 700; }
        .title-section { display: flex; justify-content: space-between; align-items: baseline; margin: 20px 0 10px; }
        .doc-title { font-size: 48px; font-weight: 700; margin: 0; color: var(--black); }
        .doc-number { font-size: 16px; font-weight: 600; color: var(--black); }
        .date-line { text-align: right; font-size: 12px; margin-bottom: 20px; }
        
        .financial-summary { display: flex; justify-content: space-between; align-items: flex-start; margin: 30px 0; gap: 20px; }
        .fin-block { flex: 1; }
        .fin-block .label { font-size: 11px; color: var(--yellow); font-weight: 700; text-transform: uppercase; margin-bottom: 4px; }
        .fin-block .value { font-size: 14px; font-weight: 600; color: var(--black); margin-top: 4px; }
        .fin-block.total-charge { text-align: right; }
        .fin-block.total-charge .label { font-size: 12px; }
        .fin-block.total-charge .amount { font-size: 32px; font-weight: 900; color: var(--black); }
        .products-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .products-table thead th { background: white; border-bottom: 2px solid var(--light-gray); padding: 12px; text-align: left; font-size: 11px; font-weight: 700; color: var(--black); text-transform: uppercase; }
        .products-table tbody td { padding: 14px 12px; border-bottom: 1px solid var(--light-gray); font-size: 12px; color: var(--black); }
        .products-table tbody tr:last-child td { border-bottom: none; }
        .products-table .text-right { text-align: right; }
        .products-table .text-center { text-align: center; }
        .products-table col.desc { width: 50%; }
        .products-table col.qty { width: 15%; }
        .products-table col.total { width: 35%; }
        .totals-section { display: flex; justify-content: flex-end; margin-top: 20px; }
        .totals-box { min-width: 350px; background: white; }
        .totals-row { display: flex; justify-content: space-between; padding: 12px 16px; font-size: 14px; font-weight: 700; border-top: 2px solid var(--black); }
        .note { margin-top: 30px; padding: 12px; background: var(--light-gray); border-left: 4px solid var(--yellow); font-size: 11px; color: var(--gray); display: flex; align-items: center; gap: 8px; }
        .note::before { content: '●'; color: var(--yellow); font-size: 16px; }
        .footer { margin-top: auto; padding-top: 20px; display: flex; justify-content: space-between; align-items: center; font-size: 9px; color: var(--gray); flex-wrap: wrap; gap: 8px; }
        .footer-item { white-space: nowrap; }
        .footer-item strong { color: var(--black); font-weight: 600; margin-right: 2px; }
    </style>
</head>
<body>
    <div class="no-print">
        <button id="printBtn" class="btn-print">Imprimer</button>
        <button id="returnBtn" class="btn-return">Retour</button>
    </div>

    <div class="quotation-page">
        <div class="logo-brand">POWERCLASSS</div>

        <div class="header-section">
            <div class="info-column">
                <h3>Informations du client</h3>
                <p><strong>Client:</strong></p>
                {% if quotation.client %}
                <p>{{ quotation.client.name }}</p>
                {% endif %}
                <p style="margin-top: 12px;"><strong>N de téléphone:</strong></p>
                {% if quotation.client and quotation.client.phone %}
                <p>{{ quotation.client.phone }}</p>
                {% endif %}
                <p style="margin-top: 12px;"><strong>Adresses:</strong></p>
                {% if quotation.client and quotation.client.address %}
                <p>{{ quotation.client.address }}{% if quotation.client.city %}, {{ quotation.client.city }}{% endif %}</p>
                {% endif %}
            </div>
            <div class="info-column">
                <h3>Informations du (entreprise)</h3>
                <p><strong>Contacts:</strong></p>
                {% if settings.phone %}<p>{{ settings.phone }}</p>{% endif %}
                {% if settings.phone2 %}<p>{{ settings.phone2 }}</p>{% endif %}
                <p style="margin-top: 12px;"><strong>Bank Account Name</strong></p>
                {% if settings.email %}<p>{{ settings.email }}</p>{% endif %}
                <p style="margin-top: 12px;"><strong>Adresses:</strong></p>
                <p>{{ settings.address or '' }}{% if settings.city %}, {{ settings.city }}{% endif %}</p>
            </div>
        </div>

        <div class="title-section">
            <h1 class="doc-title">Devis</h1>
            <div style="text-align: right;">
                <p class="doc-number">N°D #{{ quotation.quotation_number }}</p>
            </div>
        </div>

        <div class="date-line">
            <strong>Date de délivrance :</strong> {{ quotation.date | format_date }}
        </div>

        <div class="financial-summary">
            <div class="fin-block">
                <div class="label">VALIDITÉ</div>
                <div class="value">{{ quotation.expiry_date | format_date }}</div>
            </div>
            <div class="fin-block total-charge">
                <div class="label">TOTAL CHARGE</div>
                <div class="amount">{{ (quotation.total or 0) | format_cfa }}</div>
            </div>
        </div>

        <table class="products-table">
            <colgroup>
                <col class="desc">
                <col class="qty">
                <col class="total">
            </colgroup>
            <thead>
                <tr>
                    <th>DESCRIPTION</th>
                    <th class="text-center">QTIE</th>
                    <th class="text-right">TOTAL</th>
                </tr>
            </thead>
            <tbody>
                {% for item in quotation.items %}
                <tr>
                    <td>{{ item.product_name }}</td>
                    <td class="text-center">{{ item.quantity }}</td>
                    <td class="text-right">{{ (item.total or 0) | format_cfa }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="totals-section">
            <div class="totals-box">
                <div class="totals-row">
                    <span>TOTAL</span>
                    <span>{{ (quotation.total or 0) | format_cfa }}</span>
                </div>
            </div>
        </div>

        <div class="note">
            Un reçu attestant le paiement peut être envoyé au numéro / à l'adresse e-mail fournis.
        </div>

        <div class="footer">
            <div class="footer-item"><strong>YouTube</strong> @PowerClasss</div>
            <div class="footer-item"><strong>Instagram</strong> @power.classs</div>
            <div class="footer-item"><strong>TikTok</strong> @power.classs</div>
            <div class="footer-item"><strong>SnapChat</strong> powerclasss</div>
            <div class="footer-item"><strong>WhatsApp</strong> {{ settings.phone or '+221 77 299 04 04' }}</div>
            <div class="footer-item"><strong>X</strong> powerclasss</div>
            <div class="footer-item"><strong>Facebook</strong> PowerClasss</div>
            <div class="footer-item"><strong>iThreads</strong> @power.classs</div>
            <div class="footer-item"><strong>Telegram</strong> powerclasss</div>
            <div class="footer-item"><strong>Pinterest</strong> powerclasss</div>
            <div class="footer-item"><strong>LinkedIn</strong> powerclasss</div>
        </div>
    </div>

    <script>
        window.onload = function(){
            document.getElementById('printBtn')?.addEventListener('click', function(){ window.print(); });
            document.getElementById('returnBtn')?.addEventListener('click', function(){ window.location.href = '/quotations'; });
            const isInPopup = !!window.opener && window.name === 'quotation_print_popup';
            if (isInPopup) { setTimeout(() => window.print(), 400); }
        };
        window.onafterprint = function(){ if (!!window.opener && window.name === 'quotation_print_popup') { try{ window.close(); }catch(e){} } };
    </script>
</body>
</html>
